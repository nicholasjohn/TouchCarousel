(function(){$.fn.touchCarousel=function(e){function d(e){console.log(e);var t=e===1?0:e-1,n=-(t*$(".js-touch-item").width());u.stop().animate({"margin-left":n},r,i)}$this=this;this.addClass("js-touch-carousel");var t=$.extend({newsetting:0},e);var n=t.slideDuration,r=t.transitionDuration,i=t.easing,s=t.width,o=$(".touch-tab").length;if(s=="100%"){$(".js-touch-carousel").css("width","100%");s=$(".js-touch-carousel").width()}else{s=parseInt(s,10);$(".js-touch-carousel").width(s)}var u=$('<div class="touch-reel js-touch-reel" />').width(o*s),a=$('<div class="touch-item js-touch-item" />').append(u);$(".js-touch-carousel").prepend(a);$(".js-touch-carousel .touch-tab").wrapAll('<div class="touch-tabs js-touch-tabs" />');$(".js-touch-carousel .touch-tab").each(function(e,t){var n=$(this).find("img"),r=$(this).children("a"),i=$(this).find("h3"),o=$(this).find(".meta"),a=$("<img>").attr({src:n.data("carousel"),title:n.attr("alt"),alt:n.attr("alt")}),f=$("<h3>").addClass("h1 article-title").html(i.text()),l=$("<a>").attr({href:r.attr("href")}).append(a).append(f),c=$("<div>").width(s).addClass("article").append(l).append(o);u.append(c);var h=$("<div>").addClass("reel-timer-overlay js-reel-timer-overlay"),p=$("<div>").addClass("reel-timer").append(h);$(this).addClass("js-touch-tab").attr("data-slide",e+1).prepend(p)});var f=0,l=1,c=false,h=0,p;this.goToSlide=function(t){$(".touch-tab.active").removeClass("active");$(".animating").removeClass("animating");$('.touch-tab[data-slide="'+t+'"]').addClass("active").find(".js-reel-timer-overlay").addClass("animating");d(t)};this.nextSlide=function(){if(!c){$this.goToSlide(l);clearTimeout(p);p=setTimeout($this.nextSlide,n);if(l+1>o){l=1;f=4}else{f=l;l++}}};this.prevSlide=function(){if(!c){if(f-1===0){l=1;f=4}else{l=f;f--}$this.goToSlide(f);clearTimeout(p);p=setTimeout($this.nextSlide,n)}};$(".js-touch-tab").hover(function(){clearTimeout(p);$this.goToSlide($(this).data("slide"));f=$(this).data("slide");if(f+1>o){l=1}else{l=f+1}c=true;$(this).find(".js-reel-timer-overlay").removeClass("animating").addClass("full")},function(){c=false;$(this).find(".full").removeClass("full").width(0).addClass("animating");p=setTimeout(this.nextSlide,n)});this.init=function(){u.show();$(".js-reel-timer-overlay:first-of-type").width(0);setTimeout(this.nextSlide,50);return this};$(window).on("exit.two-col enter.two-col",function(){h=$(".js-touch-carousel .touch-tab:first-child").width();d(f)}).on("resize",function(){s=$(".js-touch-carousel").width();$(".js-touch-reel").width(o*s);$(".js-touch-reel .article").width(s);d(f)});var v,m,g,y,b,w,E,S=false,x=false;u.on("touchstart",function(e){c=true;w=u.css("margin-left");v=e.originalEvent.touches[0].pageX;m=e.originalEvent.touches[0].pageY;$(this).on("touchmove",function(e){g=e.originalEvent.touches[0].pageX;y=e.originalEvent.touches[0].pageY;if(Math.abs(g-v)>Math.abs(y-m)||x===true){e.preventDefault();x=true;b=g-v;E=parseInt(w,10)+b;$heroMargin=parseInt(u.css("margin-left"),10);if($heroMargin>=0){u.css({"margin-left":E*.2})}else if($heroMargin<=-($(".js-touch-item").width()*3)){u.css({"margin-left":parseInt(w,10)+b*.2})}else{u.css({"margin-left":E})}$(".js-touch-tab.active").find(".js-reel-timer-overlay").removeClass("animating").addClass("full")}else{$(this).off("touchend");$(this).off("touchmove");S=true}});$(this).on("touchend",function(e){x=false;$(this).off("touchend");$(this).off("touchmove");$(".js-touch-tab.active").find(".full").removeClass("full").width(0).addClass("animating");c=false;if(Math.abs(b)<100||S===true){u.animate({"margin-left":w});S=false}else{if(E<parseInt(w,10)){if(f!==4){clearTimeout(p);$this.nextSlide()}else{$this.goToSlide(4);clearTimeout(p);p=setTimeout($this.nextSlide,n)}}else{if(f!==1){clearTimeout(p);$this.prevSlide()}else{$this.goToSlide(1);clearTimeout(p);p=setTimeout($this.nextSlide,n)}}}b=0;v=0;m=0;y=0;g=0;w=0;E=0;S=false;x=false})});return this.init()}})()