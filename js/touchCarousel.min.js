(function(){$.fn.touchCarousel=function(e){function p(e){var t=e===1?0:e-1,n=-(t*$(".js-touch-item").width());u.stop().animate({"margin-left":n},r,i)}$this=this;this.addClass("js-touch-carousel");var t=$.extend({slideDuration:4e3,transitionDuration:250,easing:"swing",width:"100%"},e);var n=t.slideDuration,r=t.transitionDuration,i=t.easing,s=t.width;if(s=="100%"){$(".js-touch-carousel").css("width","100%");s=$(".js-touch-carousel").width()}else{s=parseInt(s,10);$(".js-touch-carousel").width(s)}if($(".js-touch-carousel > img").length!==0){$carouselType="imagesOnly";var o=$(".js-touch-carousel > img").length;console.log(o);$(".js-touch-carousel > img").wrapAll('<div class="touch-tabs js-touch-tabs" />')}else if($(".js-touch-carousel > .touch-tab").length!==0){$carouselType="linksInside";var o=$(".touch-tab").length;console.log(o);$(".js-touch-carousel > .touch-tab").wrapAll('<div class="touch-tabs js-touch-tabs" />')}else if($("a:first-child > img").length!==0){$carouselType="imageLinks";var o=$(".js-touch-carousel > a").length;console.log(o);$(".js-touch-carousel > a").wrapAll('<div class="touch-tabs js-touch-tabs" />')}var u=$('<div class="touch-reel js-touch-reel" />').width(o*s);$touchItem=$('<div class="touch-item js-touch-item" />').append(u),$carouselType;$(".js-touch-carousel").prepend($touchItem);switch($carouselType){case"imagesOnly":$(".js-touch-tabs img").each(function(e,t){var n=$("<img>").attr({src:$(this).data("carousel"),title:$(this).attr("alt"),alt:$(this).attr("alt")}),r=$("<div>").width(s).addClass("article").append(n);u.append(r);var i=$("<div>").addClass("reel-timer-overlay js-reel-timer-overlay"),o=$("<div>").addClass("reel-timer").append(i);var a=$("<article>").addClass("touch-tab js-touch-tab").attr("data-slide",e+1);$(this).wrap(a);o.insertBefore($(this))});break;case"imageLinks":$(".js-touch-carousel .touch-tabs > a").each(function(e,t){var n=$(this).find("img"),r=$(this),i=$("<img>").attr({src:n.data("carousel"),title:n.attr("alt"),alt:n.attr("alt")}),o=$("<a>").attr({href:r.attr("href")}).append(i),a=$("<div>").width(s).addClass("article").append(o);u.append(a);var f=$("<div>").addClass("reel-timer-overlay js-reel-timer-overlay"),l=$("<div>").addClass("reel-timer").append(f);var c=$("<article>").addClass("touch-tab js-touch-tab").attr("data-slide",e+1);$(this).wrap(c);l.insertBefore($(this))});break;default:$(".js-touch-carousel .touch-tab").each(function(e,t){var n=$(this).find("img"),r=$(this).find("a"),i=$(this).find(".article-title"),o=$(this).find(".meta"),a=$("<img>").attr({src:n.data("carousel"),title:n.attr("alt"),alt:n.attr("alt")}),f=$("<h3>").addClass("h1 article-title").html(i.text()),l=$("<a>").attr({href:r.attr("href")}).append(a).append(f),c=$("<div>").width(s).addClass("article").append(l).append(o);u.append(c);var h=$("<div>").addClass("reel-timer-overlay js-reel-timer-overlay"),p=$("<div>").addClass("reel-timer").append(h);$(this).addClass("js-touch-tab").attr("data-slide",e+1).prepend(p)});break}var a=0,f=1,l=false,c=0,h;this.goToSlide=function(t){$(".touch-tab.active").removeClass("active");$(".animating").removeClass("animating");$('.touch-tab[data-slide="'+t+'"]').addClass("active").find(".js-reel-timer-overlay").addClass("animating");p(t)};this.nextSlide=function(){if(!l){$this.goToSlide(f);clearTimeout(h);h=setTimeout($this.nextSlide,n);if(f+1>o){f=1;a=4}else{a=f;f++}}};this.prevSlide=function(){if(!l){if(a-1===0){f=1;a=4}else{f=a;a--}$this.goToSlide(a);clearTimeout(h);h=setTimeout($this.nextSlide,n)}};$(".js-touch-tab").hover(function(){clearTimeout(h);$this.goToSlide($(this).data("slide"));a=$(this).data("slide");if(a+1>o){f=1}else{f=a+1}l=true;$(this).find(".js-reel-timer-overlay").removeClass("animating").addClass("full")},function(){l=false;$(this).find(".full").removeClass("full").width(0).addClass("animating");h=setTimeout($this.nextSlide,n)});this.init=function(){u.show();$(".js-reel-timer-overlay:first-of-type").width(0);setTimeout(this.nextSlide,50);return this};$(window).on("exit.two-col enter.two-col",function(){c=$(".js-touch-carousel .touch-tab:first-child").width();p(a)}).on("resize",function(){s=$(".js-touch-carousel").width();$(".js-touch-reel").width(o*s);$(".js-touch-reel .article").width(s);p(a)});var d,v,m,g,y,b,w,E=false,S=false;u.on("touchstart",function(e){l=true;b=u.css("margin-left");d=e.originalEvent.touches[0].pageX;v=e.originalEvent.touches[0].pageY;$(this).on("touchmove",function(e){m=e.originalEvent.touches[0].pageX;g=e.originalEvent.touches[0].pageY;if(Math.abs(m-d)>Math.abs(g-v)||S===true){e.preventDefault();S=true;y=m-d;w=parseInt(b,10)+y;$heroMargin=parseInt(u.css("margin-left"),10);if($heroMargin>=0){u.css({"margin-left":w*.2})}else if($heroMargin<=-($(".js-touch-item").width()*3)){u.css({"margin-left":parseInt(b,10)+y*.2})}else{u.css({"margin-left":w})}$(".js-touch-tab.active").find(".js-reel-timer-overlay").removeClass("animating").addClass("full")}else{$(this).off("touchend");$(this).off("touchmove");E=true}});$(this).on("touchend",function(e){S=false;$(this).off("touchend");$(this).off("touchmove");$(".js-touch-tab.active").find(".full").removeClass("full").width(0).addClass("animating");l=false;if(Math.abs(y)<20||E===true){u.animate({"margin-left":b});E=false}else{if(w<parseInt(b,10)){if(a!==4){clearTimeout(h);$this.nextSlide()}else{$this.goToSlide(4);clearTimeout(h);h=setTimeout($this.nextSlide,n)}}else{if(a!==1){clearTimeout(h);$this.prevSlide()}else{$this.goToSlide(1);clearTimeout(h);h=setTimeout($this.nextSlide,n)}}}y=0;d=0;v=0;g=0;m=0;b=0;w=0;E=false;S=false})});return this.init()}})()